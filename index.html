<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compteur Fin d'√âtudes</title>
    <style>
        :root {
            --primary: #4f46e5;
            --bg: #000000;
            --card-bg: rgba(255, 255, 255, 0.80);
            --text: #1f3237;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        h1 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .input-group {
            margin-bottom: 2rem;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            background-color: #fff;
        }

        .result-card {
            background-color: #eef2ff;
            border: 1px solid #c7d2fe;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .result-number {
            display: block;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .result-label {
            font-size: 0.9rem;
            color: #4b5563;
        }

        .hidden {
            display: none;
        }

        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Nouveaux styles */
        .btn-secondary {
            background-color: #e0e7ff;
            color: #4338ca;
            border: 1px solid #c7d2fe;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            transition: background 0.2s;
        }
        .btn-secondary:hover {
            background-color: #c7d2fe;
        }
        
        .leave-item {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }
        .leave-item input {
            flex: 1;
            min-width: 120px;
        }
        .btn-remove {
            background: #fee2e2;
            color: #991b1b;
            border: none;
            border-radius: 0.3rem;
            padding: 0.4rem 0.8rem;
            cursor: pointer;
        }
        .progress-container {
            background-color: #e5e7eb;
            border-radius: 999px;
            height: 10px;
            margin-top: 1rem;
            overflow: hidden;
        }
        .progress-bar {
            background-color: var(--primary);
            height: 100%;
            width: 0%;
            transition: width 1s ease-in-out;
        }
    </style>
</head>
<body>
    <canvas id="particles-canvas"></canvas>

    <div class="container">
        <h1>üéì Compteur Fin d'√âtudes</h1>

        <div class="input-group">
            <label for="study-mode-select">Quel est votre mode de parcours ?</label>
            <select id="study-mode-select">
                <option value="scolaire">Scolaire classique</option>
                <option value="alternance">Alternance</option>
            </select>
        </div>

        <div id="scolaire-options">
            <div class="input-group">
                <label for="zone-select">Quelle est votre zone scolaire ?</label>
                <div style="display: flex; gap: 0.5rem;">
                    <select id="zone-select">
                        <option value="A">Zone A</option>
                        <option value="B">Zone B</option>
                        <option value="C">Zone C</option>
                    </select>
                    <button id="geo-btn" class="btn-secondary" title="D√©tecter ma zone via GPS">üìç</button>
                </div>
            </div>
        </div>

        <div id="alternance-options" class="hidden">
            <label>Mes cong√©s / RTT (exclus du compte)</label>
            <div id="leaves-list"></div>
            <button id="add-leave-btn" class="btn-secondary" style="width:100%">+ Ajouter une p√©riode de cong√©s</button>
        </div>

        <div class="input-group">
            <label for="grade-select">Quelle est votre classe actuelle ?</label>
            <select id="grade-select">
                <option value="" disabled selected>-- Choisir une classe --</option>
                <!-- Coll√®ge -->
                <option value="11">6√®me</option>
                <option value="10">5√®me</option>
                <option value="9">4√®me</option>
                <option value="8">3√®me</option>
                <!-- Lyc√©e -->
                <option value="7">2nde</option>
                <option value="6">1√®re</option>
                <option value="5">Terminale</option>
                <!-- Sup√©rieur -->
                <option value="4">Bac +1</option>
                <option value="3">Bac +2</option>
                <option value="2">Bac +3</option>
                <option value="1">Bac +4</option>
                <option value="0">Bac +5 (Derni√®re ann√©e)</option>
            </select>
        </div>

        <div class="input-group">
            <label for="target-select">√Ä quel niveau souhaitez-vous arr√™ter ?</label>
            <select id="target-select">
                <option value="" disabled selected>-- Choisir un objectif --</option>
                <!-- Coll√®ge -->
                <option value="11">6√®me</option>
                <option value="10">5√®me</option>
                <option value="9">4√®me</option>
                <option value="8">3√®me</option>
                <!-- Lyc√©e -->
                <option value="7">2nde</option>
                <option value="6">1√®re</option>
                <option value="5">Terminale</option>
                <!-- Sup√©rieur -->
                <option value="4">Bac +1</option>
                <option value="3">Bac +2</option>
                <option value="2">Bac +3</option>
                <option value="1">Bac +4</option>
                <option value="0">Bac +5</option>
            </select>
        </div>

        <div id="results" class="hidden">
            <div class="result-card">
                <span class="result-label" id="days-left-year-label">Jours restants cette ann√©e</span>
                <span id="days-left-year" class="result-number">0</span>
            </div>

            <div class="result-card">
                <span class="result-label" id="total-time-left-label">Temps total avant la fin des √©tudes</span>
                <span id="total-time-left" class="result-number">0</span>
                <div id="total-details" style="margin-top: 5px; font-size: 0.9rem; color: #4b5563;"></div>
                <div class="progress-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM ELEMENTS ---
        const studyModeSelect = document.getElementById('study-mode-select');
        const scolaireOptionsDiv = document.getElementById('scolaire-options');
        const alternanceOptionsDiv = document.getElementById('alternance-options');
        const zoneSelect = document.getElementById('zone-select');
        const gradeSelect = document.getElementById('grade-select');
        const targetSelect = document.getElementById('target-select');
        const resultsDiv = document.getElementById('results');
        const daysLeftYearSpan = document.getElementById('days-left-year');
        const daysLeftYearLabel = document.getElementById('days-left-year-label');
        const totalTimeLeftSpan = document.getElementById('total-time-left');
        const totalTimeLeftLabel = document.getElementById('total-time-left-label');
        const totalDetailsDiv = document.getElementById('total-details');
        const leavesListDiv = document.getElementById('leaves-list');
        const addLeaveBtn = document.getElementById('add-leave-btn');
        const geoBtn = document.getElementById('geo-btn');
        const progressBar = document.getElementById('progress-bar');

        // --- HOLIDAY DATA & HELPERS ---
        const schoolHolidaysData = {
            "2023-2024": {
                "A": [ { start: new Date("2023-10-21"), end: new Date("2023-11-06") }, { start: new Date("2023-12-23"), end: new Date("2024-01-08") }, { start: new Date("2024-02-17"), end: new Date("2024-03-04") }, { start: new Date("2024-04-13"), end: new Date("2024-04-29") }, { start: new Date("2024-07-06"), end: new Date("2024-09-02") } ],
                "B": [ { start: new Date("2023-10-21"), end: new Date("2023-11-06") }, { start: new Date("2023-12-23"), end: new Date("2024-01-08") }, { start: new Date("2024-02-24"), end: new Date("2024-03-11") }, { start: new Date("2024-04-20"), end: new Date("2024-05-06") }, { start: new Date("2024-07-06"), end: new Date("2024-09-02") } ],
                "C": [ { start: new Date("2023-10-21"), end: new Date("2023-11-06") }, { start: new Date("2023-12-23"), end: new Date("2024-01-08") }, { start: new Date("2024-02-10"), end: new Date("2024-02-26") }, { start: new Date("2024-04-06"), end: new Date("2024-04-22") }, { start: new Date("2024-07-06"), end: new Date("2024-09-02") } ]
            },
            "2024-2025": {
                "A": [ { start: new Date("2024-10-19"), end: new Date("2024-11-04") }, { start: new Date("2024-12-21"), end: new Date("2025-01-06") }, { start: new Date("2025-02-22"), end: new Date("2025-03-10") }, { start: new Date("2025-04-19"), end: new Date("2025-05-05") }, { start: new Date("2025-07-05"), end: new Date("2025-09-01") } ],
                "B": [ { start: new Date("2024-10-19"), end: new Date("2024-11-04") }, { start: new Date("2024-12-21"), end: new Date("2025-01-06") }, { start: new Date("2025-02-08"), end: new Date("2025-02-24") }, { start: new Date("2025-04-05"), end: new Date("2025-04-21") }, { start: new Date("2025-07-05"), end: new Date("2025-09-01") } ],
                "C": [ { start: new Date("2024-10-19"), end: new Date("2024-11-04") }, { start: new Date("2024-12-21"), end: new Date("2025-01-06") }, { start: new Date("2025-02-15"), end: new Date("2025-03-03") }, { start: new Date("2025-04-12"), end: new Date("2025-04-28") }, { start: new Date("2025-07-05"), end: new Date("2025-09-01") } ]
            }
        };

        // Mapping D√©partements -> Zones (Simplifi√©)
        const deptZones = {
            "01":"A","02":"B","03":"A","04":"B","05":"B","06":"B","07":"A","08":"B","09":"C",
            "10":"B","11":"C","12":"C","13":"B","14":"B","15":"A","16":"A","17":"A","18":"B","19":"A",
            "21":"A","22":"B","23":"A","24":"A","25":"A","26":"A","27":"B","28":"B","29":"B",
            "2A":"A","2B":"A","30":"C","31":"C","32":"C","33":"A","34":"C","35":"B","36":"B","37":"B","38":"A","39":"A",
            "40":"A","41":"B","42":"A","43":"A","44":"B","45":"B","46":"C","47":"A","48":"C","49":"B",
            "50":"B","51":"B","52":"B","53":"B","54":"B","55":"B","56":"B","57":"B","58":"A","59":"B",
            "60":"B","61":"B","62":"B","63":"A","64":"A","65":"C","66":"C","67":"B","68":"B","69":"A",
            "70":"A","71":"A","72":"B","73":"A","74":"A","75":"C","76":"B","77":"C","78":"C","79":"A",
            "80":"B","81":"C","82":"C","83":"B","84":"B","85":"B","86":"A","87":"A","88":"B","89":"A",
            "90":"A","91":"C","92":"C","93":"C","94":"C","95":"C"
        };

        function getEaster(year) {
            const a = year % 19, b = Math.floor(year / 100), c = year % 100, d = Math.floor(b / 4), e = b % 4, f = Math.floor((b + 8) / 25), g = Math.floor((b - f + 1) / 3), h = (19 * a + b - d - g + 15) % 30, i = Math.floor(c / 4), k = c % 4, l = (32 + 2 * e + 2 * i - h - k) % 7, m = Math.floor((a + 11 * h + 22 * l) / 451), month = Math.floor((h + l - 7 * m + 114) / 31), day = ((h + l - 7 * m + 114) % 31) + 1;
            return new Date(year, month - 1, day);
        }

        const publicHolidaysCache = {};
        function getPublicHolidays(year) {
            if (publicHolidaysCache[year]) return publicHolidaysCache[year];
            const holidays = new Set();
            const addHoliday = (date) => holidays.add(date.setHours(0, 0, 0, 0));
            addHoliday(new Date(year, 0, 1));  // Jour de l'An
            addHoliday(new Date(year, 4, 1));  // F√™te du Travail
            addHoliday(new Date(year, 4, 8));  // Victoire 1945
            addHoliday(new Date(year, 6, 14)); // F√™te Nationale
            addHoliday(new Date(year, 7, 15)); // Assomption
            addHoliday(new Date(year, 10, 1)); // Toussaint
            addHoliday(new Date(year, 10, 11));// Armistice 1918
            addHoliday(new Date(year, 11, 25));// No√´l
            const easter = getEaster(year);
            const addEasterHoliday = (days) => { const d = new Date(easter); d.setDate(easter.getDate() + days); addHoliday(d); };
            addEasterHoliday(1);  // Lundi de P√¢ques
            addEasterHoliday(39); // Ascension
            addEasterHoliday(50); // Lundi de Pentec√¥te
            publicHolidaysCache[year] = holidays;
            return holidays;
        }

        // Gestion intelligente des ann√©es scolaires (pass√©es, pr√©sentes, futures)
        function getSchoolYear(date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            return month < 8 ? `${year - 1}-${year}` : `${year}-${year + 1}`; // School year changes in September
        }

        function getSchoolHolidays(date, zone) {
            const schoolYear = getSchoolYear(date);
            
            // 1. Donn√©es statiques existantes
            if (schoolHolidaysData[schoolYear] && schoolHolidaysData[schoolYear][zone]) {
                return schoolHolidaysData[schoolYear][zone];
            }

            // 2. Projection pour le futur (Fallback)
            // On prend les vacances de 2024-2025 et on ajoute 52 semaines * diff√©rence d'ann√©es
            const refYear = "2024-2025";
            const refStartYear = 2024;
            const currentStartYear = parseInt(schoolYear.split('-')[0]);
            const yearDiff = currentStartYear - refStartYear;
            
            if (yearDiff > 0 && schoolHolidaysData[refYear]) {
                const refHolidays = schoolHolidaysData[refYear][zone];
                return refHolidays.map(h => {
                    const newStart = new Date(h.start);
                    const newEnd = new Date(h.end);
                    // D√©calage de 364 jours (52 semaines) par ann√©e de diff√©rence
                    newStart.setDate(newStart.getDate() + (364 * yearDiff));
                    newEnd.setDate(newEnd.getDate() + (364 * yearDiff));
                    return { start: newStart, end: newEnd };
                });
            }
            return [];
        }

        // --- CORE CALCULATION ENGINE ---
        function isCountedDay(date, options) {
            const dayOfWeek = date.getDay();
            // 1. Week-ends toujours exclus
            if (dayOfWeek === 0 || dayOfWeek === 6) return false;

            // 2. Jours f√©ri√©s toujours exclus
            const year = date.getFullYear();
            if (getPublicHolidays(year).has(new Date(date).setHours(0, 0, 0, 0))) return false;

            // 3. Mode Scolaire : Vacances scolaires exclues
            if (options.mode === 'scolaire') {
                const holidays = getSchoolHolidays(date, options.zone);
                for (const period of holidays) {
                    if (date >= period.start && date < period.end) return false;
                }
            }
            
            // 4. Mode Alternance : Cong√©s utilisateur exclus
            if (options.mode === 'alternance' && options.leaves) {
                for (const leave of options.leaves) {
                    if (date >= leave.start && date <= leave.end) return false;
                }
            }

            return true;
        }

        // --- USER LEAVES MANAGEMENT (Alternance) ---
        let userLeaves = [];

        function renderLeaves() {
            leavesListDiv.innerHTML = '';
            userLeaves.forEach((leave, index) => {
                const div = document.createElement('div');
                div.className = 'leave-item';
                div.innerHTML = `
                    <input type="date" value="${leave.start.toISOString().split('T')[0]}" onchange="updateLeave(${index}, 'start', this.value)">
                    <span>au</span>
                    <input type="date" value="${leave.end.toISOString().split('T')[0]}" onchange="updateLeave(${index}, 'end', this.value)">
                    <button class="btn-remove" onclick="removeLeave(${index})">√ó</button>
                `;
                leavesListDiv.appendChild(div);
            });
            saveState();
            updateCalculations();
        }

        window.addLeave = () => {
            const today = new Date();
            const nextWeek = new Date();
            nextWeek.setDate(today.getDate() + 5);
            userLeaves.push({ start: today, end: nextWeek });
            renderLeaves();
        };

        window.removeLeave = (index) => {
            userLeaves.splice(index, 1);
            renderLeaves();
        };

        window.updateLeave = (index, field, value) => {
            userLeaves[index][field] = new Date(value);
            saveState();
            updateCalculations();
        };

        addLeaveBtn.addEventListener('click', window.addLeave);

        // --- MAIN UPDATE FUNCTION ---
        function updateCalculations() {
            const mode = studyModeSelect.value;
            const zone = zoneSelect.value;
            
            // Sauvegarde auto
            saveState();

            if (!gradeSelect.value || !targetSelect.value || (mode === 'scolaire' && !zone)) {
                resultsDiv.classList.add('hidden');
                return;
            }

            const currentGrade = parseInt(gradeSelect.value);
            const targetGrade = parseInt(targetSelect.value);
            const yearsRemaining = Math.max(0, currentGrade - targetGrade);

            const now = new Date();
            now.setHours(0, 0, 0, 0);

            let endOfStudiesYear = now.getFullYear() + yearsRemaining;
            const endOfStudiesDate = new Date(endOfStudiesYear, 6, 7); // End of school year is July 7th

            let currentSchoolYearEnd = new Date(now.getFullYear(), 6, 7);
            if (now > currentSchoolYearEnd) {
                currentSchoolYearEnd.setFullYear(currentSchoolYearEnd.getFullYear() + 1);
            }

            let countedDaysTotal = 0;
            let countedDaysThisYear = 0;
            let currentDate = new Date(now);

            const options = { mode, zone, leaves: userLeaves };

            while (currentDate <= endOfStudiesDate) {
                if (isCountedDay(currentDate, options)) {
                    countedDaysTotal++;
                    if (currentDate <= currentSchoolYearEnd) {
                        countedDaysThisYear++;
                    }
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // Update UI
            const dayTypeName = mode === 'scolaire' ? 'scolaires' : 'travaill√©s';
            daysLeftYearLabel.textContent = `Jours ${dayTypeName} restants cette ann√©e`;
            totalTimeLeftLabel.textContent = `Total des jours ${dayTypeName} restants`;

            daysLeftYearSpan.textContent = countedDaysThisYear;
            totalTimeLeftSpan.textContent = countedDaysTotal;

            if (yearsRemaining === 0 && countedDaysTotal > 0) {
                totalDetailsDiv.textContent = "C'est la derni√®re ligne droite !";
            } else if (countedDaysTotal === 0) {
                 totalDetailsDiv.textContent = "Objectif d√©j√† atteint ou d√©pass√© !";
            }
            else {  
                totalDetailsDiv.textContent = `Jusqu'au ~${endOfStudiesDate.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' })}`;
            }

            // Progress Bar (Estimation visuelle sur une base de 5 ans max pour l'√©chelle)
            const maxDays = 220 * 5; // ~220 jours ouvr√©s * 5 ans
            const percentage = Math.min(100, Math.max(5, (countedDaysTotal / maxDays) * 100));
            progressBar.style.width = `${Math.min(100, (countedDaysTotal > 0 ? 100 : 0))}%`;
            // On inverse la logique pour la barre : elle se vide √† mesure qu'on approche
            // Ou on peut faire une barre de progression "accomplie". Faisons une barre de "charge restante".
            // Plus simple : juste une barre d√©corative pour l'instant ou relative √† l'ann√©e.
            // Faisons une barre relative √† l'ann√©e en cours :
            const totalDaysInSchoolYear = 200; // Approx
            const percentYear = Math.min(100, (countedDaysThisYear / totalDaysInSchoolYear) * 100);
            progressBar.style.width = `${percentYear}%`;
            progressBar.title = "Charge de l'ann√©e en cours";

            resultsDiv.classList.remove('hidden');
        }

        // --- GEOLOCATION ---
        geoBtn.addEventListener('click', () => {
            if (!navigator.geolocation) {
                alert("La g√©olocalisation n'est pas support√©e par votre navigateur.");
                return;
            }
            geoBtn.textContent = "‚è≥";
            navigator.geolocation.getCurrentPosition(async (position) => {
                try {
                    const { latitude, longitude } = position.coords;
                    const response = await fetch(`https://geo.api.gouv.fr/communes?lat=${latitude}&lon=${longitude}&fields=codeDepartement`);
                    const data = await response.json();
                    if (data && data.length > 0) {
                        const dept = data[0].codeDepartement;
                        const detectedZone = deptZones[dept];
                        if (detectedZone) {
                            zoneSelect.value = detectedZone;
                            geoBtn.textContent = "‚úÖ Zone " + detectedZone;
                            updateCalculations();
                            setTimeout(() => geoBtn.textContent = "üìç", 2000);
                        } else {
                            throw new Error("Zone inconnue");
                        }
                    }
                } catch (e) {
                    console.error(e);
                    alert("Impossible de d√©tecter la zone scolaire automatiquement.");
                    geoBtn.textContent = "üìç";
                }
            }, () => {
                alert("Acc√®s √† la position refus√©.");
                geoBtn.textContent = "üìç";
            });
        });

        // --- LOCAL STORAGE ---
        function saveState() {
            const state = {
                mode: studyModeSelect.value,
                zone: zoneSelect.value,
                grade: gradeSelect.value,
                target: targetSelect.value,
                leaves: userLeaves
            };
            localStorage.setItem('studyCounterState', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('studyCounterState');
            if (saved) {
                const state = JSON.parse(saved);
                if (state.mode) studyModeSelect.value = state.mode;
                if (state.zone) zoneSelect.value = state.zone;
                if (state.grade) gradeSelect.value = state.grade;
                if (state.target) targetSelect.value = state.target;
                if (state.leaves) {
                    userLeaves = state.leaves.map(l => ({ start: new Date(l.start), end: new Date(l.end) }));
                    renderLeaves(); // This calls updateCalculations internally
                }
            }
            handleInputChange(); // Refresh UI visibility
        }

        // --- EVENT LISTENERS ---
        function handleInputChange() {
            const mode = studyModeSelect.value;
            scolaireOptionsDiv.style.display = mode === 'scolaire' ? 'block' : 'none';
            alternanceOptionsDiv.style.display = mode === 'alternance' ? 'block' : 'none';
            updateCalculations();
        }

        studyModeSelect.addEventListener('change', handleInputChange);
        zoneSelect.addEventListener('change', updateCalculations);
        gradeSelect.addEventListener('change', updateCalculations);
        targetSelect.addEventListener('change', updateCalculations);

        // Init
        loadState();

        // --- Syst√®me de Particules Interactif ---
        const canvas = document.getElementById('particles-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particlesArray;

        // Position de la souris
        let mouse = {
            x: null,
            y: null,
            radius: (canvas.height / 80) * (canvas.width / 80)
        }

        window.addEventListener('mousemove', function(event) {
            mouse.x = event.x;
            mouse.y = event.y;
        });

        // Redimensionnement
        window.addEventListener('resize', function() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            mouse.radius = (canvas.height / 80) * (canvas.width / 80);
            initParticles();
        });

        class Particle {
            constructor(x, y, directionX, directionY, size, color) {
                this.x = x;
                this.y = y;
                this.directionX = directionX;
                this.directionY = directionY;
                this.size = size;
                this.color = color;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
            update() {
                if (this.x > canvas.width || this.x < 0) this.directionX = -this.directionX;
                if (this.y > canvas.height || this.y < 0) this.directionY = -this.directionY;

                // Interaction souris (r√©pulsion)
                let dx = mouse.x - this.x;
                let dy = mouse.y - this.y;
                let distance = Math.sqrt(dx*dx + dy*dy);
                if (distance < mouse.radius + this.size) {
                    if (mouse.x < this.x && this.x < canvas.width - this.size * 10) this.x += 3;
                    if (mouse.x > this.x && this.x > this.size * 10) this.x -= 3;
                    if (mouse.y < this.y && this.y < canvas.height - this.size * 10) this.y += 3;
                    if (mouse.y > this.y && this.y > this.size * 10) this.y -= 3;
                }
                this.x += this.directionX;
                this.y += this.directionY;
                this.draw();
            }
        }

        function initParticles() {
            particlesArray = [];
            let numberOfParticles = (canvas.height * canvas.width) / 9000;
            for (let i = 0; i < numberOfParticles; i++) {
                let size = (Math.random() * 3) + 1;
                let x = (Math.random() * ((innerWidth - size * 2) - (size * 2)) + size * 2);
                let y = (Math.random() * ((innerHeight - size * 2) - (size * 2)) + size * 2);
                let directionX = (Math.random() * 2) - 1;
                let directionY = (Math.random() * 2) - 1;
                let color = '#ffffff';
                particlesArray.push(new Particle(x, y, directionX, directionY, size, color));
            }
        }

        function animateParticles() {
            requestAnimationFrame(animateParticles);
            ctx.clearRect(0, 0, innerWidth, innerHeight);
            for (let i = 0; i < particlesArray.length; i++) {
                particlesArray[i].update();
            }
        }

        initParticles();
        animateParticles();
    </script>
</body>
</html>